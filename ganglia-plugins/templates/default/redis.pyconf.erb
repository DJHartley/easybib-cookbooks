<%-
if node[:scalarium] && node[:scalarium][:roles][:redis][:instances].any?
    redis_instance = node[:scalarium][:roles][:redis][:instances].first
    host           = redis_instance[:private_ip]
else
    host = node[:ganglia_plugins][:redis][:host]
end
%>
modules {
  module {
    name = "redis"
    language = "python"
    param host { value = "<%= host %>" }
    param port { value = <%= node[:ganglia_plugins][:redis][:port] %> }
  }
}
collection_group {
  collect_every = 10
  time_threshold = 60
  metric { name = "connected_clients" }
  metric { name = "connected_slaves" }
  metric { name = "blocked_clients" }
  metric { name = "used_memory" }
  metric { name = "changes_since_last_save" }
  metric { name = "bgsave_in_progress" }
  metric { name = "bgrewriteaof_in_progress" }
  metric { name = "total_connections_received" }
  metric { name = "total_commands_processed" }
  metric { name = "expired_keys" }
  metric { name = "pubsub_channels" }
  metric { name = "pubsub_patterns" }
  metric { name = "vm_enabled" }
  metric { name = "master_last_io_seconds_ago" }
}